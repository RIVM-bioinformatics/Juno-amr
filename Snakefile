"""
Juno-amr
Authors: Roxanne Wolthuis ....
Organization: Rijksinstituut voor Volksgezondheid en Milieu (RIVM)
Department: Infektieziekteonderzoek, Diagnostiek en Laboratorium Surveillance (IDS), Bacteriologie (BPD)
Date: 30 - 03 - 2021
"""

#################################################################################
#####   Import config file                                                  #####
#################################################################################
configfile: "config/user_parameters.yml"
configfile: "config/database_config.yml"

OUT = config["Parameters"]["output_dir"]
#################################################################################
#####   Load processes                                                      #####
#################################################################################
include: "bin/rules/runResfinderFastq.smk"
#include: "bin/rules/runResfinderFasta.smk"
include: "bin/rules/makeResfinderSummary.smk"

#################################################################################
#####   Specify final output                                                #####
#################################################################################
#localrules:
#    all

rule all:
    """ Main rule that starts the complete workflow """
    resources: 
        mem_mb=config["mem_mb"]

    input: 
        #These filenames are generated by resfinder, these are the most important files i think, but we could add all output files
        # expand("output/{sample}/ResFinder_results.txt", sample=config["samples_fasta"]),
        expand(OUT + "/results_per_sample/{sample}/ResFinder_results_tab.txt", sample=config["samples_fastq_r1"]),
        expand(OUT + "/results_per_sample/{sample}/pheno_table.txt", sample=config["samples_fastq_r1"]),
        expand(OUT + "/results_per_sample/{sample}/PointFinder_results.txt", sample=config["samples_fastq_r1"]),
        expand(OUT + "/results_per_sample/{sample}/PointFinder_prediction.txt", sample=config["samples_fastq_r1"]),
        expand(OUT + "/summary/summary_amr_genes.csv"),
        expand(OUT + "/summary/summary_amr_phenotype.csv"),
        expand(OUT + "/summary/summary_amr_pointfinder_results.csv"),
        expand(OUT + "/summary/summary_amr_pointfinder_prediction.csv"),
        expand(OUT + "/results_per_sample/{sample}", sample=config["samples_fastq_r1"])
        
